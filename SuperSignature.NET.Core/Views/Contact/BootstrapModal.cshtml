@model SuperSignature.MVC.Core.Models.SignatureModel

@{
    Layout = "../Shared/_Layout.cshtml";
}
<style>
    .modal-dialog {
        width: 80%;
        margin: auto;
    }
</style>

<h1 class="mt-5">@ViewBag.Title</h1>
<br />
<button type="button" class="btn btn-primary btn-lg" data-toggle="modal" data-target="#signModal">
    Click To Sign
</button>
<br/>

<img src="" id="imgSign" />

<!-- The Modal -->
<div class="modal fade" id="signModal">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">

            <!-- Modal Header -->
            <div class="modal-header">
                <h4 class="modal-title">Please Sign</h4>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>

            <!-- Modal body -->
            <div id="signModalBody" class="modal-body">

                @Html.Partial("_SignControl", Model)

            </div>

            <!-- Modal footer -->
            <div class="modal-footer">
                <button type="button" id="btnSave" class="btn btn-success" onclick="SaveSign();">Save</button>
                <button type="button" class="btn btn-info" data-dismiss="modal">Close</button>
            </div>

        </div>
    </div>
</div>


@section scripts
{
    <script language="javascript">

        var resizing = false;
        var signModalBody = $("#signModalBody");
        var isMobile = false;
        var signH = 0;

        if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
            isMobile = true;
        }

        function Resize() {
            if (resizing) {
                return;
            }

            resizing = true;

            var signW = parseInt(signModalBody.width());

            if (signH === 0) {
                signH = parseInt(signModalBody.height());
            }

            ResizeSignature("ctlSignature", signW - 20, signH);
            resizing = false;
        }


        $("#signModal").on('shown.bs.modal',
            function(e) {
                Resize();
            });

        function SaveSign() {

            var btnSave = $("#btnSave");

            var tp = SignatureTotalPoints('ctlSignature');
            if (tp > 20) {


                btnSave.prop('disabled', true);

                var ctlSignature = {
                    Data: $("#ctlSignature_data").val(),
                    Smooth: $("#ctlSignature_data_smooth").val()
                };

                $.ajax({
                    url: "/Contact/SaveSignature/",
                    data: JSON.stringify(ctlSignature),
                    contentType: "application/json",
                    type: 'POST',
                    cache: false,
                    success: function(data) {
                        $("#imgSign").attr("src", "/Signatures/" + data);
                        $('#signModal').modal('hide');
                    },
                    error: function(textStatus, errorThrown) {
                        alert("Unable to save signatures : " + JSON.stringify(textStatus) + " : " + errorThrown);
                    }
                });

                btnSave.prop('disabled', false);
            }

        }

        function AttachEvents() {

            if (isMobile) {

                $(window).on("orientationchange",
                    function(e) {
                        Resize();
                    });


            } else {

                $(window).on("resize",
                    function() {
                        Resize();
                    });
            }

        }

        AttachEvents();

    </script>
}
